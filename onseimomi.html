<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>YouTube音声のみ＋音声認識UI</title>
  <style>
    body { font-family: sans-serif; padding: 20px; text-align: center; background: #f0f4f8; }
    iframe { display: none; } /* 映像を非表示にして軽くする */
    input, button {
      font-size: 18px;
      padding: 8px;
      width: 80%;
      margin: 10px auto;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
    #recognized, #resultList {
      font-size: 18px;
      margin: 10px auto;
      max-width: 600px;
      background: #fff;
      padding: 10px;
      border-radius: 8px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
      text-align: left;
      white-space: pre-wrap;
    }
  </style>
</head>
<body>
  <h1>🎧 音声のみでタイピング練習</h1>
  <p>🔊 YouTube音声を流して、聞き取った内容を入力してください</p>
  <iframe id="ytplayer" src="https://www.youtube.com/embed/M7lc1UVf-VE?autoplay=1" allow="autoplay" allowfullscreen></iframe>
  <div id="recognized">🗣️ 認識中…</div>
  <input type="text" id="typingInput" placeholder="Enterで判定"><br>
  <div id="resultList">📋 結果：</div>

  <script>
    let recognition;
    let transcript = \"\";
    let lastCapture = \"\";

    function startRecognition() {
      if (!('webkitSpeechRecognition' in window)) {
        alert(\"Chromeで開いてください\");
        return;
      }

      recognition = new webkitSpeechRecognition();
      recognition.lang = \"ja-JP\";
      recognition.continuous = true;
      recognition.interimResults = true;

      recognition.onresult = function(event) {
        for (let i = event.resultIndex; i < event.results.length; i++) {
          transcript = event.results[i][0].transcript.trim();
        }
        document.getElementById(\"recognized\").textContent = \"🗣️ \" + transcript;
      };

      recognition.onerror = (e) => console.error(\"認識エラー:\", e);
      recognition.onend = () => {
        console.log(\"認識が終了、再起動\");
        startRecognition();
      };

      recognition.start();
    }

    document.getElementById(\"typingInput\").addEventListener(\"keydown\", function(e) {
      if (e.key === \"Enter\") {
        const input = this.value.trim();
        const correct = transcript.trim();
        let match = 0;
        for (let i = 0; i < Math.min(input.length, correct.length); i++) {
          if (input[i] === correct[i]) match++;
        }
        const rate = correct.length ? (match / correct.length * 100).toFixed(1) : 0;
        const log = `🎯 一致率: ${rate}%\\n🎧 音声: ${correct}\\n⌨️ 入力: ${input}`;
        const result = document.getElementById(\"resultList\");
        result.textContent = `${log}\\n------------------------\\n` + result.textContent;
        this.value = \"\";
      }
    });

    window.onload = startRecognition;
  </script>
</body>
</html>
